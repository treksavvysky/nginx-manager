# Development Docker Compose Configuration
# For local development and testing

services:
  # NGINX Manager API
  nginx-manager-api:
    build:
      context: ../..
      dockerfile: docker/api/Dockerfile
    container_name: nginx-manager-api
    ports:
      - "8000:8000"
    volumes:
      # Mount configuration directories
      - ../../test-configs:/etc/nginx/conf.d:ro
      - nginx-ssl:/etc/ssl
      - api-logs:/var/log/nginx-manager
      - api-backups:/var/backups/nginx
      # Development: mount source code for hot reload
      - ../../api:/app/api
      # Docker socket for container management
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - API_DEBUG=true
      - API_RELOAD=true
      - NGINX_CONF_DIR=/etc/nginx/conf.d
      - NGINX_CONTAINER_NAME=nginx-manager-nginx
      - LOG_LEVEL=DEBUG
    networks:
      - nginx-manager
    depends_on:
      - nginx-manager-nginx
    restart: unless-stopped

  # NGINX Web Server
  nginx-manager-nginx:
    build:
      context: ../nginx
      dockerfile: Dockerfile
    container_name: nginx-manager-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # Share configuration with API
      - ../../test-configs:/etc/nginx/conf.d:ro
      - nginx-ssl:/etc/ssl
      - nginx-logs:/var/log/nginx
    networks:
      - nginx-manager
    restart: unless-stopped

  # Optional: Web UI for development (future)
  # nginx-manager-ui:
  #   image: nginx:alpine
  #   container_name: nginx-manager-ui
  #   ports:
  #     - "3000:80"
  #   networks:
  #     - nginx-manager

volumes:
  nginx-configs:
    driver: local
  nginx-ssl:
    driver: local
  nginx-logs:
    driver: local
  api-logs:
    driver: local
  api-backups:
    driver: local

networks:
  nginx-manager:
    driver: bridge
    name: nginx-manager-network
