# Test configuration with map directives

map $uri $backend {
    default     backend1;
    /api        api_backend;
    ~^/admin    admin_backend;
    ~*\.php$    php_backend;
}

map $http_upgrade $connection_upgrade {
    default     upgrade;
    ''          close;
}

map $host $rate_limit {
    hostnames;
    default     10;
    .example.com 100;
    www.example.com 50;
}

server {
    listen 80;
    server_name example.com;
    root /var/www/html;
}
